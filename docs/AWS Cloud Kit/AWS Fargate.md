---
sidebar_position: 5
---

The DB host env variable is only a placeholder. After launching the stack get the db host and paste into the env var and relaunch the compute stack.

Use The Fargate compute file to override env variables for production. If certain env vars are the same between dev and prod then they do not need to be changed. They will be available when the docker file is built.

To send requests use the public IP of the elastic Load balancer which can be found under “Load Balancers” in the AWS EC2 console.

Firebase private key, auth secret, db password, stripe password, stripe webhook secret should all be kept in the secrets manager, everything else can be defined in env vars.

#### Database to Server Setup

- Set dbName, dbPort and dbUsername environment variables in the .env file.
- After deploying to AWS, Secrets Manager will auto generate a password. The Database Credentials are automatically passed to - the nodejs server through the fargate environment variables.
- The Database host is of course not available on the first deploy. After creating the database stack. The hostname will need to be retrieved from the RDS console. Then added to the env variable of the Fargate API server.
- Finally the new Fargate setup with the RDS hostname will need to be redeployed.

#### Database Setup

- DB password is automatically generated by AWS Secrets manager
- Remote access the database with AWS session manager through the bastion host. No ssh/keys are required.

#### Session Manager:

- Go to AWS Systems Manager Dashboard in the console
- Click on Session Manager on sidebar
- Click Start New Session
- Select the cdk generated Bastion Host and click Start Session
- install postgres on the bastion host sudo amazon-linux-extras install postgresql11
- Get RDS hostname (see below)
- connect to the database with the psql shell using the following command. database name, database port and database username were set by the user in the .env file. psql -d name-of-db -h host-name -p port -U username
- Copy and paste the password from Secrets Manager (see below)
- Copy and paste the create table commands from server/Database/schema.sql

#### Get RDS hostname

- Go RDS dashboard on the console
- Click on Databases in the sidebar
- Click on the database generated by cdk
- hostname will be under "Endpoint and Port"

#### Get DB Password from Secrets Manager:

- Go to Secrets Manager Dashboard on the console
- Click on Secrets in sidebar
- Click on the secret generated by CDK
- Scroll down to Secret Value and Click "Retrieve Secret Value"
